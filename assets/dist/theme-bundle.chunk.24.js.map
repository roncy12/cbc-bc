{"version":3,"sources":["webpack:///./assets/js/theme/search.js"],"names":["Search","formatCategoryTreeForJSTree","node","nodeData","text","data","id","metadata","state","selected","opened","children","forEach","childNode","push","showProducts","url","urlUtils","replaceParams","window","location","href","section","$productListingContainer","removeClass","$contentResultsContainer","addClass","$","goToUrl","showContent","onReady","$searchForm","$categoryTreeContainer","find","Url","parse","treeData","$facetedSearchContainer","length","initFacetedSearch","onSortBySubmit","bind","hooks","on","collapsibleFactory","event","preventDefault","query","validator","initValidation","bindValidation","context","categoryTree","categoryTreeData","createCategoryTree","selectedCategoryIds","jstree","get_selected","check","remove","categoryId","input","type","name","value","append","loadTreeNodes","cb","ajax","selectedCategoryId","prefix","done","formattedResults","dataNode","$container","treeOptions","core","themes","icons","checkbox","three_state","plugins","$searchHeading","$searchCount","productsPerPage","searchProductsPerPage","requestOptions","template","productListing","sidebar","heading","productCount","config","product_results","limit","showMore","facetedSearch","FacetedSearch","content","html","animate","scrollTop","$form","nod","submit","$element","add","selector","validate","errorMessage","performCheck","areAll","CatalogPage"],"mappings":"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","file":"theme-bundle.chunk.24.js","sourcesContent":["import { hooks } from '@bigcommerce/stencil-utils';\nimport CatalogPage from './catalog';\nimport $ from 'jquery';\nimport FacetedSearch from './common/faceted-search';\nimport urlUtils from './common/url-utils';\nimport Url from 'url';\nimport collapsibleFactory from './common/collapsible';\nimport 'jstree';\nimport nod from './common/nod';\n\nexport default class Search extends CatalogPage {\n    formatCategoryTreeForJSTree(node) {\n        const nodeData = {\n            text: node.data,\n            id: node.metadata.id,\n            state: {\n                selected: node.selected,\n            },\n        };\n\n        if (node.state) {\n            nodeData.state.opened = node.state === 'open';\n            nodeData.children = true;\n        }\n\n        if (node.children) {\n            nodeData.children = [];\n            node.children.forEach((childNode) => {\n                nodeData.children.push(this.formatCategoryTreeForJSTree(childNode));\n            });\n        }\n\n        return nodeData;\n    }\n\n    showProducts() {\n        const url = urlUtils.replaceParams(window.location.href, {\n            section: 'product',\n        });\n\n        this.$productListingContainer.removeClass('u-hiddenVisually');\n        // this.$facetedSearchContainer.removeClass('u-hiddenVisually');\n        this.$contentResultsContainer.addClass('u-hiddenVisually');\n\n        $('[data-content-results-toggle]').removeClass('navBar-action-color--active');\n        $('[data-content-results-toggle]').addClass('navBar-action');\n\n        $('[data-product-results-toggle]').removeClass('navBar-action');\n        $('[data-product-results-toggle]').addClass('navBar-action-color--active');\n\n        urlUtils.goToUrl(url);\n    }\n\n    showContent() {\n        const url = urlUtils.replaceParams(window.location.href, {\n            section: 'content',\n        });\n\n        this.$contentResultsContainer.removeClass('u-hiddenVisually');\n        this.$productListingContainer.addClass('u-hiddenVisually');\n        // this.$facetedSearchContainer.addClass('u-hiddenVisually');\n\n        $('[data-product-results-toggle]').removeClass('navBar-action-color--active');\n        $('[data-product-results-toggle]').addClass('navBar-action');\n\n        $('[data-content-results-toggle]').removeClass('navBar-action');\n        $('[data-content-results-toggle]').addClass('navBar-action-color--active');\n\n        urlUtils.goToUrl(url);\n    }\n\n    onReady() {\n        const $searchForm = $('[data-advanced-search-form]');\n        const $categoryTreeContainer = $searchForm.find('[data-search-category-tree]');\n        const url = Url.parse(window.location.href, true);\n        const treeData = [];\n        this.$productListingContainer = $('#product-listing-container');\n        this.$facetedSearchContainer = $('#faceted-search-container');\n        this.$contentResultsContainer = $('#search-results-content');\n\n        // Init faceted search\n        if ($('#facetedSearch').length > 0) {\n            this.initFacetedSearch();\n        } else {\n            this.onSortBySubmit = this.onSortBySubmit.bind(this);\n            hooks.on('sortBy-submitted', this.onSortBySubmit);\n        }\n\n        // Init collapsibles\n        collapsibleFactory();\n\n        $('[data-product-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showProducts();\n        });\n\n        $('[data-content-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showContent();\n        });\n\n        if (this.$productListingContainer.find('li.product').length === 0 || url.query.section === 'content') {\n            this.showContent();\n        } else {\n            this.showProducts();\n        }\n\n        const validator = this.initValidation($searchForm)\n            .bindValidation($searchForm.find('#search_query_adv'));\n\n        this.context.categoryTree.forEach((node) => {\n            treeData.push(this.formatCategoryTreeForJSTree(node));\n        });\n\n        this.categoryTreeData = treeData;\n        this.createCategoryTree($categoryTreeContainer);\n\n        $searchForm.on('submit', event => {\n            const selectedCategoryIds = $categoryTreeContainer.jstree().get_selected();\n\n            if (!validator.check()) {\n                return event.preventDefault();\n            }\n\n            $searchForm.find('input[name=\"category\\[\\]\"]').remove();\n\n            for (const categoryId of selectedCategoryIds) {\n                const input = $('<input>', {\n                    type: 'hidden',\n                    name: 'category[]',\n                    value: categoryId,\n                });\n\n                $searchForm.append(input);\n            }\n        });\n    }\n\n    loadTreeNodes(node, cb) {\n        $.ajax({\n            url: '/remote/v1/category-tree',\n            data: {\n                selectedCategoryId: node.id,\n                prefix: 'category',\n            },\n        }).done(data => {\n            const formattedResults = [];\n\n            data.forEach((dataNode) => {\n                formattedResults.push(this.formatCategoryTreeForJSTree(dataNode));\n            });\n\n            cb(formattedResults);\n        });\n    }\n\n    createCategoryTree($container) {\n        const treeOptions = {\n            core: {\n                data: (node, cb) => {\n                    // Root node\n                    if (node.id === '#') {\n                        cb(this.categoryTreeData);\n                    } else {\n                        // Lazy loaded children\n                        this.loadTreeNodes(node, cb);\n                    }\n                },\n                themes: {\n                    icons: true,\n                },\n            },\n            checkbox: {\n                three_state: false,\n            },\n            plugins: [\n                'checkbox',\n            ],\n        };\n\n        $container.jstree(treeOptions);\n    }\n\n    initFacetedSearch() {\n        const $productListingContainer = $('#product-listing-container');\n        const $facetedSearchContainer = $('#faceted-search-container');\n        const $searchHeading = $('#search-results-heading');\n        const $searchCount = $('#search-results-product-count');\n        const productsPerPage = this.context.searchProductsPerPage;\n        const requestOptions = {\n            template: {\n                productListing: 'search/product-listing',\n                sidebar: 'search/sidebar',\n                heading: 'search/heading',\n                productCount: 'search/product-count',\n            },\n            config: {\n                product_results: {\n                    limit: productsPerPage,\n                },\n            },\n            showMore: 'search/show-more',\n        };\n\n        this.facetedSearch = new FacetedSearch(requestOptions, (content) => {\n            $productListingContainer.html(content.productListing);\n            $facetedSearchContainer.html(content.sidebar);\n            $searchHeading.html(content.heading);\n            $searchCount.html(content.productCount);\n\n            $('html, body').animate({\n                scrollTop: 0,\n            }, 100);\n        });\n    }\n\n    initValidation($form) {\n        this.$form = $form;\n        this.validator = nod({\n            submit: $form,\n        });\n\n        return this;\n    }\n\n    bindValidation($element) {\n        if (this.validator) {\n            this.validator.add({\n                selector: $element,\n                validate: 'presence',\n                errorMessage: $element.data('errorMessage'),\n            });\n        }\n\n        return this;\n    }\n\n    check() {\n        if (this.validator) {\n            this.validator.performCheck();\n            return this.validator.areAll('valid');\n        }\n\n        return false;\n    }\n}\n"],"sourceRoot":""}